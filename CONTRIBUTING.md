a brief description of howto
============================

## new phone who dis

This repository powers the Mapzen data pages [Metro Extracts](https://mapzen.com/data/metro-extracts/) and [Borders](https://mapzen.com/data/borders/). They were formerly grafted onto a mega-Rails app but really did not need to be in there crufting up the joint so we untangled it from there. Now it generates a static page, whenever the data sources are generated. So this is better, but even still the backend Node-based service is merely an implementation of what used to be the front-end code and things are still sewed together with a considerable amount of spaghetti.

## ingredients

- in `src/templates/` there is a single [Mustache](https://mustache.github.io/) template. This is the page that gets built ultimately.
- in `pages/` there is a YAML file that represents values that will go into the template. The build script also reads some information from this file that it needs to know what to do.
- in `lib/` there is the Node.js scripts that will download S3 manifests generated by the data pipeline and then use that to build a page with the template. The logic is based on the old front-end scripts as well as the generator for another project I had handy. There's no particular reason why Node is the best tool for this job.
- in `src/scripts/` there is the remaining front-end code. `datapages.js` is shared functionality. There is also `borders.js` and `metro.js` which are page specific. These scripts depend on the shared `datapages.js` and one of the things it does is just assume everything is in the global scope.

Files are generated by running `make` which additionally copies over some third-party assets that are required. The generated files are put into a `dist/` folder which is then mounted to wherever it needs to go.

## todo

Suggestions and PRs are welcome.

